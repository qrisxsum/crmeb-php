# CRMEB 商城系统测试文档

## 目录
- [一、测试环境准备](#一测试环境准备)
- [二、系统基础功能测试](#二系统基础功能测试)
- [三、商品管理模块测试](#三商品管理模块测试)
- [四、订单管理模块测试](#四订单管理模块测试)
- [五、用户管理模块测试](#五用户管理模块测试)
- [六、营销活动模块测试](#六营销活动模块测试)
- [七、分销管理模块测试](#七分销管理模块测试)
- [八、财务管理模块测试](#八财务管理模块测试)
- [九、内容管理模块测试](#九内容管理模块测试)
- [十、系统设置模块测试](#十系统设置模块测试)
- [十一、客服管理模块测试](#十一客服管理模块测试)
- [十二、数据统计模块测试](#十二数据统计模块测试)
- [十三、文件管理模块测试](#十三文件管理模块测试)
- [十四、物流管理模块测试](#十四物流管理模块测试)
- [十五、消息通知模块测试](#十五消息通知模块测试)
- [十六、应用管理模块测试](#十六应用管理模块测试)
- [十七、DIY页面模块测试](#十七diy页面模块测试)
- [十八、商户管理模块测试](#十八商户管理模块测试)
- [十九、移动端API测试](#十九移动端api测试)
- [二十、性能与压力测试](#二十性能与压力测试)
- [二十一、安全测试](#二十一安全测试)
- [二十二、兼容性测试](#二十二兼容性测试)

---

## 一、测试环境准备

### 1.1 环境要求

| 组件 | 版本要求 | 说明 |
|------|---------|------|
| PHP | 7.1 ~ 7.4 | 必须 |
| MySQL | 5.7 ~ 8.0 | 必须，引擎：InnoDB |
| Redis | 7.0 | 可选，不安装则使用文件缓存 |
| Nginx | 1.22 | 推荐 |
| Node.js | 14/18 | 前端开发需要 |
| Docker | 最新版 | 使用Docker部署时 |

### 1.2 Docker环境部署（推荐）

#### 1.2.1 启动服务

```bash
cd /home/ubuntu/Projects/CRMEB/docker-compose
docker-compose up -d
```

#### 1.2.2 检查服务状态

```bash
# 检查容器运行状态
docker ps

# 检查MySQL连接
docker exec -it crmeb_mysql mysql -uroot -p123456 -e "SHOW DATABASES;"

# 检查Redis连接
docker exec -it crmeb_redis redis-cli ping

# 检查PHP-FPM
docker exec -it crmeb_php php -v
```

#### 1.2.3 导入数据库

```bash
# 进入MySQL容器
docker exec -it crmeb_mysql bash

# 导入数据库（在容器内执行）
mysql -uroot -p123456 crmeb < /var/www/public/install/crmeb.sql

# 或从宿主机导入
docker exec -i crmeb_mysql mysql -uroot -p123456 crmeb < ../crmeb/public/install/crmeb.sql
```

#### 1.2.4 配置环境变量

编辑 `crmeb/.env` 文件：

```env
APP_DEBUG = true

[APP]
DEFAULT_TIMEZONE = Asia/Shanghai

[DATABASE]
TYPE = mysql
HOSTNAME = 192.168.10.11  # Docker网络中的MySQL IP
HOSTPORT = 3306
DATABASE = crmeb
USERNAME = root
PASSWORD = 123456
PREFIX = eb_
CHARSET = utf8mb4
DEBUG = true

[CACHE]
DRIVER = redis
CACHE_PREFIX = cache_crmeb:
CACHE_TAG_PREFIX = cache_tag_crmeb:

[REDIS]
REDIS_HOSTNAME = 192.168.10.10  # Docker网络中的Redis IP
PORT = 6379
REDIS_PASSWORD = 
SELECT = 0

[QUEUE]
QUEUE_NAME = crmeb_queue
```

#### 1.2.5 启动队列和定时任务

```bash
# 进入PHP容器
docker exec -it crmeb_php bash

# 启动消息队列
php think queue:listen --queue

# 启动定时任务（后台运行）
php think timer start --d

# 启动长连接服务（后台运行）
php think workerman start --d
```

#### 1.2.6 访问系统

- **管理后台**：http://localhost:8011/admin
- **H5端**：http://localhost:8011/
- **默认账号**：admin
- **默认密码**：crmeb.com

### 1.3 非Docker环境部署

参考 `crmeb/README.md` 进行手动安装。

---

## 二、系统基础功能测试

### 2.1 登录功能测试

#### 测试用例 TC-001：管理员登录

**测试步骤：**
1. 访问管理后台登录页面：`http://localhost:8011/admin`
2. 输入用户名：`admin`
3. 输入密码：`crmeb.com`
4. 输入验证码（如需要）
5. 点击"登录"按钮

**预期结果：**
- ✅ 登录成功，跳转到后台首页
- ✅ 显示管理员信息
- ✅ 生成登录token，后续请求携带token

**测试数据：**
- 正确账号：admin / crmeb.com
- 错误账号：admin / wrong_password（应提示密码错误）

#### 测试用例 TC-002：登录失败处理

**测试步骤：**
1. 输入错误的用户名或密码
2. 点击登录

**预期结果：**
- ✅ 提示"账号或密码错误"
- ✅ 验证码刷新（如启用）
- ✅ 不跳转页面

### 2.2 权限验证测试

#### 测试用例 TC-003：菜单权限控制

**测试步骤：**
1. 使用不同权限级别的账号登录
2. 检查菜单显示情况

**预期结果：**
- ✅ 只显示有权限的菜单
- ✅ 无权限菜单不显示或置灰
- ✅ 直接访问无权限URL时返回403

### 2.3 系统信息测试

#### 测试用例 TC-004：系统信息展示

**测试步骤：**
1. 登录后台
2. 查看首页系统信息

**预期结果：**
- ✅ 显示系统版本号
- ✅ 显示服务器信息
- ✅ 显示数据库连接状态
- ✅ 显示Redis连接状态

---

## 三、商品管理模块测试

### 3.1 商品分类管理

#### 测试用例 TC-101：添加商品分类

**测试步骤：**
1. 进入"商品管理" -> "商品分类"
2. 点击"添加分类"
3. 填写分类信息：
   - 分类名称：测试分类
   - 分类图标：上传图片
   - 排序：10
   - 是否显示：是
4. 点击"提交"

**预期结果：**
- ✅ 分类创建成功
- ✅ 分类列表显示新分类
- ✅ 支持多级分类（父级分类选择）

#### 测试用例 TC-102：编辑商品分类

**测试步骤：**
1. 在分类列表中找到目标分类
2. 点击"编辑"
3. 修改分类名称
4. 保存

**预期结果：**
- ✅ 分类信息更新成功
- ✅ 列表显示更新后的信息

#### 测试用例 TC-103：删除商品分类

**测试步骤：**
1. 选择要删除的分类
2. 点击"删除"
3. 确认删除

**预期结果：**
- ✅ 分类删除成功
- ✅ 如果分类下有商品，应提示不能删除

### 3.2 商品管理

#### 测试用例 TC-104：添加商品

**测试步骤：**
1. 进入"商品管理" -> "商品管理"
2. 点击"添加商品"
3. 填写商品基本信息：
   - 商品名称：测试商品
   - 商品分类：选择分类
   - 商品图片：上传主图和多图
   - 商品简介：测试商品简介
4. 设置商品规格：
   - 添加规格（如：颜色、尺寸）
   - 设置规格值（如：红色、蓝色）
   - 设置SKU价格和库存
5. 设置商品详情（富文本编辑器）
6. 设置其他属性：
   - 商品价格
   - 库存数量
   - 运费模板
   - 是否上架
7. 点击"提交"

**预期结果：**
- ✅ 商品创建成功
- ✅ 商品列表显示新商品
- ✅ 支持多规格SKU
- ✅ 图片上传成功
- ✅ 详情页显示正确

#### 测试用例 TC-105：编辑商品

**测试步骤：**
1. 在商品列表中找到目标商品
2. 点击"编辑"
3. 修改商品信息（如价格、库存）
4. 保存

**预期结果：**
- ✅ 商品信息更新成功
- ✅ 修改后信息正确显示

#### 测试用例 TC-106：商品上架/下架

**测试步骤：**
1. 在商品列表中选择商品
2. 点击"上架"或"下架"按钮

**预期结果：**
- ✅ 状态切换成功
- ✅ 下架商品前端不显示
- ✅ 上架商品前端正常显示

#### 测试用例 TC-107：商品删除

**测试步骤：**
1. 选择要删除的商品
2. 点击"删除"
3. 确认删除

**预期结果：**
- ✅ 商品删除成功
- ✅ 如果商品有订单，应提示不能删除

#### 测试用例 TC-108：商品批量操作

**测试步骤：**
1. 勾选多个商品
2. 选择批量操作（上架/下架/删除）
3. 执行操作

**预期结果：**
- ✅ 批量操作成功
- ✅ 所有选中商品状态更新

### 3.3 商品规格管理

#### 测试用例 TC-109：添加商品规格

**测试步骤：**
1. 进入"商品管理" -> "商品规格"
2. 点击"添加规格"
3. 填写规格名称（如：颜色）
4. 添加规格值（如：红色、蓝色、绿色）
5. 保存

**预期结果：**
- ✅ 规格创建成功
- ✅ 可在添加商品时选择该规格

### 3.4 商品评价管理

#### 测试用例 TC-110：查看商品评价

**测试步骤：**
1. 进入"商品管理" -> "商品评价"
2. 查看评价列表

**预期结果：**
- ✅ 显示所有商品评价
- ✅ 显示评价内容、评分、用户信息
- ✅ 支持筛选和搜索

#### 测试用例 TC-111：回复商品评价

**测试步骤：**
1. 找到目标评价
2. 点击"回复"
3. 输入回复内容
4. 提交

**预期结果：**
- ✅ 回复成功
- ✅ 评价详情页显示回复内容

#### 测试用例 TC-112：删除商品评价

**测试步骤：**
1. 选择要删除的评价
2. 点击"删除"
3. 确认删除

**预期结果：**
- ✅ 评价删除成功

---

## 四、订单管理模块测试

### 4.1 订单列表查询

#### 测试用例 TC-201：订单列表查询

**测试步骤：**
1. 进入"订单管理" -> "订单列表"
2. 查看订单列表
3. 使用筛选条件（订单状态、时间范围、订单号）

**预期结果：**
- ✅ 显示所有订单
- ✅ 显示订单基本信息（订单号、用户、金额、状态）
- ✅ 筛选功能正常
- ✅ 支持分页

### 4.2 订单详情

#### 测试用例 TC-202：查看订单详情

**测试步骤：**
1. 在订单列表中找到目标订单
2. 点击"详情"

**预期结果：**
- ✅ 显示订单完整信息
- ✅ 显示商品信息
- ✅ 显示收货地址
- ✅ 显示订单状态流转记录

### 4.3 订单发货

#### 测试用例 TC-203：订单发货

**测试步骤：**
1. 找到待发货订单
2. 点击"发货"
3. 填写发货信息：
   - 选择物流公司
   - 输入物流单号
4. 点击"确认发货"

**预期结果：**
- ✅ 发货成功
- ✅ 订单状态更新为"已发货"
- ✅ 用户收到发货通知（如配置）

### 4.4 订单退款/退货

#### 测试用例 TC-204：处理退款申请

**测试步骤：**
1. 进入"订单管理" -> "退款订单"
2. 找到退款申请
3. 查看退款原因和详情
4. 选择"同意退款"或"拒绝退款"
5. 填写处理备注
6. 提交

**预期结果：**
- ✅ 同意退款：订单状态更新，退款金额退回用户账户
- ✅ 拒绝退款：订单状态恢复，用户收到拒绝通知
- ✅ 退款记录可查询

#### 测试用例 TC-205：处理退货申请

**测试步骤：**
1. 进入"订单管理" -> "退货订单"
2. 找到退货申请
3. 审核退货申请
4. 确认收货后处理退款

**预期结果：**
- ✅ 退货流程完整
- ✅ 退款金额正确计算

### 4.5 订单导出

#### 测试用例 TC-206：导出订单

**测试步骤：**
1. 在订单列表设置筛选条件
2. 点击"导出"
3. 选择导出字段
4. 确认导出

**预期结果：**
- ✅ 生成Excel文件
- ✅ 文件包含筛选的订单数据
- ✅ 数据格式正确

### 4.6 订单统计

#### 测试用例 TC-207：订单统计查看

**测试步骤：**
1. 进入"订单管理" -> "订单统计"
2. 查看统计数据

**预期结果：**
- ✅ 显示订单数量统计
- ✅ 显示订单金额统计
- ✅ 支持按时间筛选
- ✅ 图表展示清晰

---

## 五、用户管理模块测试

### 5.1 用户列表

#### 测试用例 TC-301：用户列表查询

**测试步骤：**
1. 进入"用户管理" -> "用户列表"
2. 查看用户列表
3. 使用筛选条件（注册时间、用户等级、标签）

**预期结果：**
- ✅ 显示所有用户
- ✅ 显示用户基本信息（昵称、手机、余额、积分）
- ✅ 筛选功能正常
- ✅ 支持搜索（手机号、昵称）

### 5.2 用户详情

#### 测试用例 TC-302：查看用户详情

**测试步骤：**
1. 在用户列表中找到目标用户
2. 点击"详情"

**预期结果：**
- ✅ 显示用户完整信息
- ✅ 显示用户订单记录
- ✅ 显示用户余额变动记录
- ✅ 显示用户积分变动记录
- ✅ 显示用户标签

### 5.3 用户编辑

#### 测试用例 TC-303：编辑用户信息

**测试步骤：**
1. 找到目标用户
2. 点击"编辑"
3. 修改用户信息（昵称、手机号等）
4. 保存

**预期结果：**
- ✅ 用户信息更新成功
- ✅ 手机号唯一性验证

### 5.4 用户余额管理

#### 测试用例 TC-304：调整用户余额

**测试步骤：**
1. 进入用户详情
2. 点击"余额调整"
3. 选择操作类型（增加/减少）
4. 输入金额
5. 填写备注
6. 提交

**预期结果：**
- ✅ 余额调整成功
- ✅ 余额变动记录可查询
- ✅ 余额不能为负数（如设置）

### 5.5 用户积分管理

#### 测试用例 TC-305：调整用户积分

**测试步骤：**
1. 进入用户详情
2. 点击"积分调整"
3. 选择操作类型（增加/减少）
4. 输入积分数量
5. 填写备注
6. 提交

**预期结果：**
- ✅ 积分调整成功
- ✅ 积分变动记录可查询

### 5.6 用户标签管理

#### 测试用例 TC-306：添加用户标签

**测试步骤：**
1. 进入"用户管理" -> "用户标签"
2. 点击"添加标签"
3. 填写标签名称和颜色
4. 保存

**预期结果：**
- ✅ 标签创建成功
- ✅ 可在用户详情中给用户打标签

#### 测试用例 TC-307：给用户打标签

**测试步骤：**
1. 进入用户详情
2. 点击"添加标签"
3. 选择标签
4. 保存

**预期结果：**
- ✅ 标签添加成功
- ✅ 用户列表可按标签筛选

### 5.7 用户等级管理

#### 测试用例 TC-308：用户等级设置

**测试步骤：**
1. 进入"用户管理" -> "用户等级"
2. 查看等级列表
3. 编辑等级权益（折扣、积分倍率等）

**预期结果：**
- ✅ 等级权益设置成功
- ✅ 用户达到条件自动升级

---

## 六、营销活动模块测试

### 6.1 优惠券管理

#### 测试用例 TC-401：创建优惠券

**测试步骤：**
1. 进入"营销" -> "优惠券制作"
2. 点击"添加优惠券"
3. 填写优惠券信息：
   - 优惠券名称：测试优惠券
   - 优惠券类型：满减券/折扣券
   - 使用门槛：满100元
   - 优惠金额：10元
   - 发放数量：100张
   - 有效期：设置开始和结束时间
4. 设置使用范围（全部商品/指定分类/指定商品）
5. 保存

**预期结果：**
- ✅ 优惠券创建成功
- ✅ 优惠券列表显示新券

#### 测试用例 TC-402：发放优惠券

**测试步骤：**
1. 进入"营销" -> "优惠券列表"
2. 找到目标优惠券
3. 点击"发放"
4. 选择发放方式（手动发放/用户领取）
5. 如手动发放，选择用户
6. 提交

**预期结果：**
- ✅ 优惠券发放成功
- ✅ 用户账户中出现对应优惠券
- ✅ 未超发（发放数量受限于总发行量）

#### 测试用例 TC-403：用户领取优惠券

**测试步骤：**
1. 在前端（H5/小程序）登录用户账号
2. 进入"领券中心"或活动页面
3. 领取指定优惠券
4. 在"个人中心" -> "优惠券"中查看

**预期结果：**
- ✅ 用户可正常领取符合规则的优惠券
- ✅ 重复领取时有提示（如：已领取/超出限制）
- ✅ 个人中心显示优惠券状态（未使用/已使用/已过期）

#### 测试用例 TC-404：下单使用优惠券

**测试步骤：**
1. 使用有可用优惠券的用户登录前端
2. 将符合优惠券条件的商品加入购物车
3. 进入结算页，选择优惠券
4. 提交订单并完成支付（可使用测试支付方式）

**预期结果：**
- ✅ 订单金额正确使用优惠金额或折扣
- ✅ 实付金额计算正确
- ✅ 优惠券状态变为"已使用"
- ✅ 后台订单详情中显示使用的优惠券信息

### 6.2 拼团活动测试

#### 测试用例 TC-405：创建拼团活动

**测试步骤：**
1. 进入"营销" -> "拼团管理"
2. 点击"添加拼团商品"
3. 选择商品并设置：
   - 拼团价格
   - 成团人数
   - 活动时间
4. 保存

**预期结果：**
- ✅ 拼团活动创建成功
- ✅ 前端拼团列表显示该活动

#### 测试用例 TC-406：发起拼团并参团

**测试步骤：**
1. 用户A在前端选择拼团商品，点击"发起拼团"
2. 用户B通过分享链接进入活动页面，点击"参团"
3. 支付成功后查看拼团状态

**预期结果：**
- ✅ 用户A拼团订单创建成功
- ✅ 用户B参团订单创建成功
- ✅ 成团人数满足条件后，拼团状态变为"拼团成功"
- ✅ 未在有效期内成团的订单变为"拼团失败"并触发退款流程（如配置）

### 6.3 秒杀活动测试

#### 测试用例 TC-407：创建秒杀活动

**测试步骤：**
1. 进入"营销" -> "秒杀管理"
2. 点击"添加秒杀商品"
3. 设置秒杀时间段、秒杀价格、限购数量等
4. 保存

**预期结果：**
- ✅ 秒杀活动创建成功
- ✅ 活动时间段内前端秒杀场次可见

#### 测试用例 TC-408：秒杀抢购

**测试步骤：**
1. 调整系统时间到秒杀活动时间段
2. 用户在前端进入秒杀页面
3. 选择秒杀商品，尝试下单

**预期结果：**
- ✅ 在库存范围内可以成功下单
- ✅ 超出限购数量时有提示
- ✅ 秒杀结束后不可再下单

### 6.4 砍价活动测试

#### 测试用例 TC-409：发起砍价

**测试步骤：**
1. 进入前端砍价活动页面
2. 选择砍价商品，点击"发起砍价"
3. 分享砍价链接给其他用户

**预期结果：**
- ✅ 砍价活动创建成功
- ✅ 生成可分享的砍价链接

#### 测试用例 TC-410：参与砍价

**测试步骤：**
1. 其他用户通过分享链接进入砍价页面
2. 点击"帮TA砍一刀"

**预期结果：**
- ✅ 每个用户只能砍价一次（按配置）
- ✅ 商品价格按规则逐步降低
- ✅ 达到底价后不能继续砍价

---

## 七、分销管理模块测试

### 7.1 分销员管理

#### 测试用例 TC-501：申请成为分销员

**测试步骤：**
1. 前端用户登录
2. 在"分销中心"点击"申请成为分销员"（如需申请）
3. 填写申请资料并提交
4. 后台进入"分销管理" -> "分销员管理"查看

**预期结果：**
- ✅ 生成分销员申请记录
- ✅ 配置为自动审核时自动通过
- ✅ 配置为人工审核时状态为"待审核"

#### 测试用例 TC-502：审核分销员

**测试步骤：**
1. 后台进入"分销管理" -> "分销员管理"
2. 找到待审核申请
3. 点击"审核"，选择"通过"/"拒绝"

**预期结果：**
- ✅ 状态更新为"已通过"或"已拒绝"
- ✅ 用户在前端分销中心看到对应结果

### 7.2 分销订单与佣金

#### 测试用例 TC-503：分销订单生成

**测试步骤：**
1. 用户A成为分销员
2. 用户A分享商品推广链接或二维码
3. 新用户B通过推广链接访问并注册/下单

**预期结果：**
- ✅ 后台"分销订单"中记录B的订单并关联推广人A
- ✅ 订单完成后生成待结算佣金

#### 测试用例 TC-504：佣金结算与提现

**测试步骤：**
1. 订单完成并超过售后期
2. 后台查看"佣金记录"
3. 分销员在前端发起佣金提现申请
4. 后台审核提现申请并打款

**预期结果：**
- ✅ 订单对应佣金从"待结算"变为"可提现"
- ✅ 提现申请生成记录
- ✅ 审核通过后佣金从账户扣减

---

## 八、财务管理模块测试

### 8.1 资金流水

#### 测试用例 TC-601：资金流水记录

**测试步骤：**
1. 触发多种资金变动场景（下单支付、退款、充值、提现等）
2. 后台进入"财务管理" -> "资金记录"

**预期结果：**
- ✅ 每一笔资金变动都有记录
- ✅ 记录包含类型、金额、关联订单/用户、时间等信息

### 8.2 充值与提现

#### 测试用例 TC-602：用户充值

**测试步骤：**
1. 前端用户进入"余额充值"页面
2. 选择充值金额并提交
3. 模拟支付成功

**预期结果：**
- ✅ 余额增加对应金额
- ✅ 后台充值记录中有对应记录

#### 测试用例 TC-603：用户提现

**测试步骤：**
1. 用户前端发起余额提现
2. 后台进入"提现管理"查看
3. 审核通过/拒绝

**预期结果：**
- ✅ 审核通过后余额扣减
- ✅ 审核拒绝时余额不变并有备注

---

## 九、内容管理模块测试

### 9.1 文章管理

#### 测试用例 TC-701：发布文章

**测试步骤：**
1. 进入"内容管理" -> "文章管理"
2. 点击"添加文章"
3. 填写标题、分类、封面、内容
4. 保存并发布

**预期结果：**
- ✅ 文章列表显示新文章
- ✅ 前端文章列表/详情页可正常访问

#### 测试用例 TC-702：文章编辑与删除

**测试步骤：**
1. 编辑已有文章内容并保存
2. 删除一篇测试文章

**预期结果：**
- ✅ 编辑后内容更新成功
- ✅ 删除文章后前端不再展示

---

## 十、系统设置模块测试

### 10.1 基础配置

#### 测试用例 TC-801：商城基础配置

**测试步骤：**
1. 进入"系统设置" -> "商城设置"
2. 修改商城名称、LOGO、联系方式等
3. 保存

**预期结果：**
- ✅ 配置保存成功
- ✅ 前端对应展示信息更新

### 10.2 支付与短信配置

#### 测试用例 TC-802：支付配置

**测试步骤：**
1. 配置微信/支付宝支付参数（测试环境）
2. 发起一笔测试订单并支付

**预期结果：**
- ✅ 支付流程可正常走通（或在沙箱环境正常）
- ✅ 支付回调能正确更新订单状态

#### 测试用例 TC-803：短信配置

**测试步骤：**
1. 在"通知设置"中配置短信服务商信息
2. 触发短信场景（注册验证码/发货通知）

**预期结果：**
- ✅ 短信发送记录中有对应记录
- ✅ 实际手机可收到短信（如接入真实通道）

---

## 十一、客服管理模块测试

### 11.1 在线客服

#### 测试用例 TC-901：客服会话

**测试步骤：**
1. 启动 Workerman 长连接服务
2. 前端用户发起客服会话
3. 后台客服账号登录客服工作台
4. 双向发送消息

**预期结果：**
- ✅ 消息实时收发，无明显延迟
- ✅ 会话记录可在后台查看

---

## 十二、数据统计模块测试

### 12.1 运营数据看板

#### 测试用例 TC-1001：核心指标统计

**测试步骤：**
1. 进入"数据统计" -> "运营数据"
2. 查看订单数、成交额、新增用户等曲线

**预期结果：**
- ✅ 图表展示正常，无报错
- ✅ 统计数据与实际订单/用户数据大致一致（允许少量缓存延迟）
